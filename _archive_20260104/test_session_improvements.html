<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Sess√£o Expirada</title>
</head>

<body>
    <h1>Teste das Melhorias de Sess√£o</h1>
    <p>As melhorias implementadas incluem:</p>
    <ul>
        <li>‚úÖ Mensagens de erro mais claras quando a sess√£o expira</li>
        <li>‚úÖ Confirma√ß√£o para redirecionar ao login</li>
        <li>‚úÖ Verifica√ß√£o peri√≥dica de sess√£o (a cada 5 minutos)</li>
        <li>‚úÖ Endpoint check_session.php para verificar status</li>
    </ul>

    <p><strong>Para testar:</strong></p>
    <ol>
        <li>Fa√ßa login no sistema</li>
        <li>V√° para uma p√°gina de site survey</li>
        <li>Espere a sess√£o expirar (cerca de 24 minutos) ou force expirando a sess√£o</li>
        <li>Tente editar algo - deve aparecer uma mensagem clara</li>
    </ol>

    <p><a href="index.php">Voltar ao Dashboard</a></p>

    <script>
        // Simular uma chamada que falha por sess√£o expirada
        function testSessionExpired() {
            // Simular resposta HTML em vez de JSON
            const mockResponse = new Response('<html><body>Login Page</body></html>', {
                status: 302,
                headers: { 'content-type': 'text/html' }
            });

            // Testar o tratamento de erro
            const contentType = mockResponse.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                if (mockResponse.status === 302 || mockResponse.status === 401 || mockResponse.redirected) {
                    alert('üîê Sess√£o expirada - fa√ßa login novamente\n\nIsso seria mostrado ao usu√°rio quando a sess√£o expirar.');
                    const shouldLogin = confirm('Sua sess√£o expirou. Voc√™ precisa fazer login novamente para continuar salvando.\n\nDeseja ir para a p√°gina de login agora?');
                    if (shouldLogin) {
                        // window.location.href = 'login.php';
                        alert('Redirecionaria para login.php');
                    }
                }
            }
        }

        // Testar verifica√ß√£o peri√≥dica
        setTimeout(() => {
            alert('Verifica√ß√£o peri√≥dica de sess√£o ativada!\nA cada 5 minutos o sistema verifica se voc√™ ainda est√° logado.');
        }, 2000);
    </script>
</body>

</html>